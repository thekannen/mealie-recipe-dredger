services:
  mealie-recipe-dredger:
    build:
      context: .
    image: mealie-recipe-dredger:latest
    container_name: mealie-recipe-dredger
    
    # All secrets and configuration loaded from .env file
    env_file:
      - .env
    
    volumes:
      - ./data:/app/data                    # Persistent data (imported.json, rejects.json, etc.)
      - ./sites.json:/app/sites.json:ro     # Runtime-editable site list
    
    restart: "no"
    
  # ğŸ§¹ Maintenance: Master Cleaner
  # Run manually with: docker compose run --rm mealie-cleaner
  mealie-cleaner:
    build:
      context: .
    image: mealie-recipe-dredger:latest
    container_name: mealie-cleaner
    command: python maintenance/master_cleaner.py
    profiles: ["maintenance"]
    
    # Inherits settings from .env
    env_file:
      - .env
    
    # Optional: Override specific settings for cleaner
    environment:
      - DRY_RUN=true         # ğŸ›¡ï¸ Extra safety: ensure dry-run
      - MAX_WORKERS=2        # Cleaner-specific: prevent database locks
    
    volumes:
      - ./data:/app/data
    
    restart: "no"
