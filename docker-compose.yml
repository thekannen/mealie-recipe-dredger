services:
  mealie-recipe-dredger:
    build:
      context: .
    image: mealie-recipe-dredger:latest
    container_name: mealie-recipe-dredger
    restart: "no"
    env_file:
      - .env
    environment:
      TASK: dredger
      RUN_MODE: once
      RUN_INTERVAL_SECONDS: 21600
    volumes:
      - ./data:/app/data
      - ./sites.json:/app/sites.json:ro
    extra_hosts:
      - "host.docker.internal:host-gateway"

  mealie-cleaner:
    build:
      context: .
    image: mealie-recipe-dredger:latest
    container_name: mealie-cleaner
    restart: "no"
    profiles: ["maintenance"]
    env_file:
      - .env
    environment:
      TASK: cleaner
      RUN_MODE: once
      DRY_RUN: true
      MAX_WORKERS: 2
    volumes:
      - ./data:/app/data
      - ./sites.json:/app/sites.json:ro
    extra_hosts:
      - "host.docker.internal:host-gateway"
